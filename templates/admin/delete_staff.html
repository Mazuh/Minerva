{% extends "admin/layout.html" %}

{% block styles %}
<link rel="stylesheet" type="text/css" href="/static/posgraduacao/css/{{ post_graduation }}.css"/>
{% endblock %}

{% block scripts %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.2-rc.1/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.2-rc.1/js/select2.min.js" type="text/javascript"></script>
<script type="text/javascript">
$(document).ready(function() {
    $("input[name=create]").val("Deletar");
    $("#functionStaff").val('coordination');
    var staff = {{ staff|tojson|safe }};
    var staff = JSON.parse(staff);
    var listOfCoordination = [];
    var listOfSecretariat = [];
    for (i = 0; i < staff.coordination.length; i++){
        if(!(staff.coordination[i].hasOwnProperty('deleted'))){
            listOfCoordination.push({
                id: i,
                text: (staff.coordination[i].name)
            })
        }
    }
    for (i = 0; i < staff.secretariat.length; i++){
        if(!(staff.secretariat[i].hasOwnProperty('deleted'))){
            listOfSecretariat.push({
                id: i,
                text: (staff.secretariat[i].name)
            })
        }
    }

    $("#list").select2({
        data: listOfCoordination
    });

    $("button").click(function(){
        var indexInStaff = $("select#list").val();
        var functionStaff = ($("#functionStaff").val());
        $("input[name=index]").val(indexInStaff);
        $("#form-edit").css("display","block");
        if(functionStaff == "coordination"){
            $("input[name=name]").val(staff.coordination[indexInStaff].name);
            $("textarea[name=abstract]").val(staff.coordination[indexInStaff].abstract);
            $("input[name=rank]").val(staff.coordination[indexInStaff].rank);
            $("input[name=photo]").val(staff.coordination[indexInStaff].photo);
            $(".img-circle").attr("src", staff.coordination[indexInStaff].photo);
            $("select[name=function]").val(functionStaff);
        } else {
            $("input[name=name]").val(staff.secretariat[indexInStaff].name);
            $("input[name=rank]").val(staff.secretariat[indexInStaff].function.rank);
            $("textarea[name=abstract]").val(staff.secretariat[indexInStaff].function.description);
            $("input[name=photo]").val("");
            $("select[name=function]").val(functionStaff);
        }

    });

    $("#functionStaff").change(function(){
        functionStaff = $(this).val();
        if($(this).val() == 'secretariat'){
            $("input[name=photo]").css('visibility','hidden');
            $("label[for='photo']").css('visibility','hidden');
            $(".img-circle").css("display", "none");
            $(".img-circle").attr("src", "")
            $("#list").html("");
            $("#list").select2({
                data: listOfSecretariat
            });
        }
        if($(this).val() == 'coordination'){
            $("input[name=photo]").css('visibility','visible');
            $("label[for='photo']").css('visibility','visible');
            $(".img-circle").css("display", "block");
            $("#list").html("");
            $("#list").select2({
                data: listOfCoordination
            });
        }
    });
});
</script>
{% endblock %}

{% block content %}

<header>
    <h2>Equipe</h2>
</header>
<h4>Selecione o servidor</h4>
    <select id="list"></select>
    <select id="functionStaff">
        <option value="coordination" selected="selected">Coordenação</option>
        <option value="secretariat">Secretária</option>
    </select>
    <button id="edit" type="button">Selecionar</button>
    <div class="form-div">
    <form method="POST" id='form-edit' action="{{ url_for('admin.delete_staff') }}">
        {{ form.csrf_token }}
        {{ form.index(required='true', style="display:none;", readonly="readonly") }}
        <br/>
        {{ form.name.label (class="label-edit")}}<br/>
        {{ form.name(required='true', class="delete-input", readonly="readonly") }}
        <br/>
        
        {{ form.abstract.label (class="label-edit")}}<br/>
        {{ form.abstract(required='true', minlength='50', maxlength='1200', class="delete-input", readonly="readonly") }}
        <br/>

        {{ form.rank.label(class="label-edit") }}<br/>
        {{ form.rank(required='true', class="delete-input", readonly="readonly") }}

        <br/>

        {{ form.function.label(style="display: none") }}<br/>
        {{ form.function(required='true', style="display: none", class="delete-input") }}
        <br/>
        {{ form.photo.label(class="label-edit")}}<br/>
        {{ form.photo(class="delete-input") }}
        <br/>
        <br/>
    
        {{ form.create }}
    
    </form>
    
    </div>
    <div class="col-md-3" style="float: right; margin-right: 20%">
        <img src="" class="img-circle pull-right" height="190" width="180">
    </div>

{% endblock %}
